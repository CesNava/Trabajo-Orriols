---
title: "GRUPAL ORRIOLS"
author: "Ruben Díaz"
date: "2024-01-07"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# VOX ESTRATEGIA ELECTORAL

##LIBRERÍAS

```{r}
library(haven)
library(dplyr)
library(forcats)
library(ggplot2)
library(tidyverse)
library(gmodels)
```


## DATOS DEL CIS CARGAMOS

```{r}
datos <- read_sav("3431.sav")
```

## PREPARACIÓN DE VARIABLES

CLASE SOCIAL SUBJETIVA

```{r}
datos$clase_subjetiva <- datos$CLASESUB

datos <- datos |> 
 mutate(clase_subjetiva = case_when(clase_subjetiva == 1 ~ "alta",
                                    clase_subjetiva == 2 ~ "media",
                                    clase_subjetiva > 2 & clase_subjetiva < 6  ~ "baja",
                                    T ~ NA)) |>
 mutate(clase_subjetiva = factor(clase_subjetiva))
 
summary(datos$clase_subjetiva)


```

ARREGLAMOS EL REC VOTO Y PONEMOS ETIQUETAS 

```{r}
datos <- datos |> 
 filter(RECUVOTOGR < 8000) |> 
 mutate(RECUVOTOGR1 = case_when(RECUVOTOGR == 2 ~ "PP",
                                RECUVOTOGR == 1 ~ "PSOE",
                                RECUVOTOGR == 3 ~ "VOX",
                                RECUVOTOGR == 21 ~  "SUMAR",
                                T ~ "OTRO")) |> 
 mutate(RECUVOTOGR1 <- as.numeric(RECUVOTOGR1))

head(datos$RECUVOTOGR1)
```


GENERAMOS DATAFRAMES PARA CLASE BAJA Y DERECHA para ver diferencias


```{r}
datos_clasebaja <- datos |> 
 filter(clase_subjetiva == "baja")

datos_clasebaja_derecha <-  datos_clasebaja |> 
 filter(ESCIDEOL > 5 & ESCIDEOL < 11) 

table(datos$RECUVOTOGR1)
table(datos_clasebaja$RECUVOTOGR1)
table(datos_clasebaja_derecha$RECUVOTOGR1)
```


VEMOS LOS PROBLEMAS MAS RELEVANTES

```{r}
datos_clasebaja_derecha_vox <-  datos_clasebaja_derecha |> 
 filter(RECUVOTOGR1 == "VOX") |> 
 filter(PESPANNA1 < 900 & PESPANNA2 < 900 & PESPANNA3 < 900)

```


```{r}
prop.table(table(datos$RECUVOTOGR1))*100
prop.table(table(datos_clasebaja$RECUVOTOGR1))*100
prop.table(table(datos_clasebaja_derecha$RECUVOTOGR1))*100

datos <- datos |> 
 mutate(RECUVOTOGR2 = RECUVOTOGR1 )

datos_clasebaja <- datos_clasebaja |> 
 mutate(ideol = case_when(ESCIDEOL < 5 ~ "izq",
                          ESCIDEOL == 5 ~ "centro",
                          ESCIDEOL > 5 ~ "der",
                          ESCIDEOL > 10 ~ NA))

table(datos_clasebaja$ideol)

CrossTable(datos$RECUVOTOGR1, datos$clase_subjetiva, format = c("SPSS"), chisq = F, prop.r = T, prop.c = F)
CrossTable(datos_clasebaja$RECUVOTOGR1, datos_clasebaja$ideol, format = c("SPSS"), chisq = F, prop.r = T, prop.t = F, prop.c = F, prop.chisq = F)



```
